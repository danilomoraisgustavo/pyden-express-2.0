<!DOCTYPE html>
<html lang="pt-br" data-bs-theme="light"> 

<head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>PyDen Express</title>
  <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport" />
  <link rel="icon" href="../../assets/img/pydenadmin/favicon.png" type="image/x-icon" />

  <!-- Fonts and icons -->
  <script src="../../assets/js/plugin/webfont/webfont.min.js"></script>
  <script>
    WebFont.load({
      google: { families: ["Public Sans:300,400,500,600,700"] },
      custom: {
        families: [
          "Font Awesome 5 Solid",
          "Font Awesome 5 Regular",
          "Font Awesome 5 Brands",
          "simple-line-icons",
        ],
        urls: ["../../assets/css/fonts.min.css"],
      },
      active: function () {
        sessionStorage.fonts = true;
      },
    });
  </script>

  <!-- CSS Files -->
  <link rel="stylesheet" href="../../assets/css/bootstrap.min.css" />
  <link rel="stylesheet" href="../../assets/css/plugins.min.css" />
  <link rel="stylesheet" href="../../assets/css/pydenadmin.min.css" />
  <link rel="stylesheet" href="../../assets/css/demo.css" />

  <!-- Google Maps API -->
  <script
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCAwvAt4l0Pkb1c52FLUE-ttVxm4YZ9J8M&libraries=places"></script>
  <style>
    #mapAluno {
      height: 400px;
      width: 100%;
    }
  </style>
</head>

<body>
  <div class="wrapper">
    <!-- SIDEBAR -->
    <div class="sidebar" data-background-color="dark">
      <div class="sidebar-logo">
        <div class="logo-header" data-background-color="dark">
          <a href="../../pages/transporte-escolar/dashboard-escolar.html" class="logo">
            <img src="../../assets/img/pydenadmin/logo_light.png" alt="navbar brand" class="navbar-brand" height="20" />
          </a>
          <div class="nav-toggle">
            <button class="btn btn-toggle toggle-sidebar"><i class="gg-menu-right"></i></button>
            <button class="btn btn-toggle sidenav-toggler"><i class="gg-menu-left"></i></button>
          </div>
          <button class="topbar-toggler more"><i class="gg-more-vertical-alt"></i></button>
        </div>
      </div>

      <div class="sidebar-wrapper scrollbar scrollbar-inner">
        <div class="sidebar-content">
          <ul class="nav nav-secondary">
            <!-- =========================================================
           =                  TRANSPORTE ESCOLAR                   =
           =======================================================-->
            <li class="nav-section">
              <span class="sidebar-mini-icon"><i class="fa fa-ellipsis-h"></i></span>
              <h4 class="text-section">Transporte Escolar</h4>
            </li>

            <li class="nav-item">
              <a href="../../pages/transporte-escolar/dashboard-escolar.html">
                <i class="fas fa-tachometer-alt"></i>
                <p>Dashboard Escolar</p>
              </a>
            </li>

            <!-- Alunos -->
            <li class="nav-item">
              <a data-bs-toggle="collapse" href="#teAlunos" aria-expanded="false">
                <i class="fas fa-user-graduate"></i>
                <p>Alunos</p><span class="caret"></span>
              </a>
              <div class="collapse" id="teAlunos">
                <ul class="nav nav-collapse">
                  <li><a href="../../pages/transporte-escolar/alunos-solicitacoes-listar.html"><span
                        class="sub-item">Listar Solicita√ß√µes de Transporte</span></a></li>
                  <li><a href="../../pages/transporte-escolar/alunos-listar.html"><span class="sub-item">Listar
                        Alunos</span></a></li>
                </ul>
              </div>
            </li>

            <!-- Motoristas -->
            <li class="nav-item">
              <a data-bs-toggle="collapse" href="#teMotoristas" aria-expanded="false">
                <i class="fas fa-id-card"></i>
                <p>Motoristas</p><span class="caret"></span>
              </a>
              <div class="collapse" id="teMotoristas">
                <ul class="nav nav-collapse">
                  <li><a href="../../pages/transporte-escolar/motoristas-listar.html"><span class="sub-item">Listar
                        Motoristas</span></a></li>
                  <li><a href="../../pages/transporte-escolar/motoristas-licencas.html"><span class="sub-item">Licen√ßas
                        e Certifica√ß√µes</span></a></li>
                </ul>
              </div>
            </li>

            <!-- Monitores -->
            <li class="nav-item">
              <a data-bs-toggle="collapse" href="#teMonitores" aria-expanded="false">
                <i class="fas fa-user-check"></i>
                <p>Monitores</p><span class="caret"></span>
              </a>
              <div class="collapse" id="teMonitores">
                <ul class="nav nav-collapse">
                  <li><a href="../../pages/transporte-escolar/monitores-listar.html"><span class="sub-item">Listar
                        Monitores</span></a></li>
                </ul>
              </div>
            </li>

            <!-- Ve√≠culos -->
            <li class="nav-item">
              <a data-bs-toggle="collapse" href="#teVeiculos" aria-expanded="false">
                <i class="fas fa-bus"></i>
                <p>Ve√≠culos</p><span class="caret"></span>
              </a>
              <div class="collapse" id="teVeiculos">
                <ul class="nav nav-collapse">
                  <li><a href="../../pages/transporte-escolar/veiculos-listar.html"><span class="sub-item">Listar
                        Ve√≠culos</span></a></li>
                  <li><a href="../../pages/transporte-escolar/veiculos-manutencao.html"><span
                        class="sub-item">Manuten√ß√£o</span></a></li>
                  <li><a href="../../pages/transporte-escolar/veiculos-documentacao.html"><span
                        class="sub-item">Documenta√ß√£o e Seguros</span></a></li>
                </ul>
              </div>
            </li>

            <!-- Rotas -->
            <li class="nav-item">
              <a data-bs-toggle="collapse" href="#teRotas" aria-expanded="false">
                <i class="fas fa-route"></i>
                <p>Rotas</p><span class="caret"></span>
              </a>
              <div class="collapse" id="teRotas">
                <ul class="nav nav-collapse">
                  <li><a href="../../pages/transporte-escolar/rotas-listar.html"><span class="sub-item">Listar
                        Rotas</span></a></li>
                  <li><a href="../../pages/transporte-escolar/pontos-cadastrar.html"><span class="sub-item">Pontos de
                        Parada</span></a></li>
                </ul>
              </div>
            </li>

            <!-- Zoneamento -->
            <li class="nav-item">
              <a data-bs-toggle="collapse" href="#teZoneamento" aria-expanded="false">
                <i class="fas fa-school"></i>
                <p>Zoneamento</p><span class="caret"></span>
              </a>
              <div class="collapse" id="teZoneamento">
                <ul class="nav nav-collapse">
                  <li><a href="../../pages/transporte-escolar/zoneamento-listar.html"><span class="sub-item">Listar
                        Zoneamento</span></a></li>
                  <li><a href="../../pages/transporte-escolar/zoneamento-cadastrar.html"><span
                        class="sub-item">Cadastrar Zoneamento</span></a></li>
                </ul>
              </div>
            </li>

            <!-- Escolas -->
            <li class="nav-item">
              <a data-bs-toggle="collapse" href="#teEscolas" aria-expanded="false">
                <i class="fas fa-school"></i>
                <p>Escolas</p><span class="caret"></span>
              </a>
              <div class="collapse" id="teEscolas">
                <ul class="nav nav-collapse">
                  <li><a href="../../pages/transporte-escolar/escolas-listar.html"><span class="sub-item">Listar
                        Escolas</span></a></li>
                </ul>
              </div>
            </li>

            <!-- Fornecedores Escolares -->
            <li class="nav-item">
              <a data-bs-toggle="collapse" href="#teFornecedores" aria-expanded="false">
                <i class="fas fa-truck-loading"></i>
                <p>Fornecedores</p><span class="caret"></span>
              </a>
              <div class="collapse" id="teFornecedores">
                <ul class="nav nav-collapse">
                  <li><a href="../../pages/transporte-escolar/fornecedores-listar.html"><span class="sub-item">Listar
                        Fornecedores</span></a></li>
                </ul>
              </div>
            </li>

            <!-- =========================================================
           =               TRANSPORTE ADMINISTRATIVO               =
           =======================================================-->
            <li class="nav-section">
              <span class="sidebar-mini-icon"><i class="fa fa-ellipsis-h"></i></span>
              <h4 class="text-section">Transporte Administrativo</h4>
            </li>

            <li class="nav-item">
              <a href="../../pages/transporte-administrativo/dashboard-administrativo.html">
                <i class="fas fa-tachometer-alt"></i>
                <p>Dashboard Administrativo</p>
              </a>
            </li>

            <!-- Motoristas ADM -->
            <li class="nav-item">
              <a data-bs-toggle="collapse" href="#taMotoristas" aria-expanded="false">
                <i class="fas fa-id-card"></i>
                <p>Motoristas</p><span class="caret"></span>
              </a>
              <div class="collapse" id="taMotoristas">
                <ul class="nav nav-collapse">
                  <li><a href="../../pages/transporte-administrativo/motoristas-listar.html"><span
                        class="sub-item">Listar Motoristas</span></a></li>
                  <li><a href="../../pages/transporte-administrativo/motoristas-cadastrar.html"><span
                        class="sub-item">Cadastrar Motorista</span></a></li>
                  <li><a href="../../pages/transporte-administrativo/motoristas-licencas.html"><span
                        class="sub-item">Licen√ßas e Certifica√ß√µes</span></a></li>
                </ul>
              </div>
            </li>

            <!-- Frota ADM -->
            <li class="nav-item">
              <a data-bs-toggle="collapse" href="#taFrota" aria-expanded="false">
                <i class="fas fa-warehouse"></i>
                <p>Frota Administrativa</p><span class="caret"></span>
              </a>
              <div class="collapse" id="taFrota">
                <ul class="nav nav-collapse">
                  <li><a href="../../pages/transporte-administrativo/frota-listar.html"><span class="sub-item">Listar
                        Frota</span></a></li>
                  <li><a href="../../pages/transporte-administrativo/frota-manutencao.html"><span
                        class="sub-item">Manuten√ß√£o</span></a></li>
                  <li><a href="../../pages/transporte-administrativo/frota-rotas.html"><span class="sub-item">Rotas
                        Internas</span></a></li>
                </ul>
              </div>
            </li>

            <!-- Fornecedores Administrativos -->
            <li class="nav-item">
              <a data-bs-toggle="collapse" href="#adminFornecedores" aria-expanded="false">
                <i class="fas fa-truck-loading"></i>
                <p>Fornecedores</p><span class="caret"></span>
              </a>
              <div class="collapse" id="adminFornecedores">
                <ul class="nav nav-collapse">
                  <li><a href="../../pages/transporte-administrativo/fornecedores-listar.html"><span
                        class="sub-item">Listar
                        Fornecedores</span></a></li>
                </ul>
              </div>

              <!-- Agenda -->
            <li class="nav-item">
              <a data-bs-toggle="collapse" href="#taAgenda" aria-expanded="false">
                <i class="far fa-calendar-alt"></i>
                <p>Agenda de Viagens</p><span class="caret"></span>
              </a>
              <div class="collapse" id="taAgenda">
                <ul class="nav nav-collapse">
                  <li><a href="../../pages/transporte-administrativo/agenda-viagens-listar.html"><span
                        class="sub-item">Listar Viagens</span></a></li>
                  
                </ul>
              </div>
            </li>

            <!-- Log√≠stica Interna -->
            

            <!-- =========================================================
           =                       FINANCEIRO                      =
           =======================================================-->
            <li class="nav-section">
              <span class="sidebar-mini-icon"><i class="fa fa-ellipsis-h"></i></span>
              <h4 class="text-section">Financeiro</h4>
            </li>

            <!-- Relat√≥rios Financeiros -->
            <li class="nav-item">
              <a data-bs-toggle="collapse" href="#finRelatorios" aria-expanded="false">
                <i class="far fa-chart-bar"></i>
                <p>Relat√≥rios Financeiros</p><span class="caret"></span>
              </a>
              <div class="collapse" id="finRelatorios">
                <ul class="nav nav-collapse">
                  <li><a href="../../pages/financeiro/relatorios-mensal.html"><span class="sub-item">Relat√≥rio
                        Mensal</span></a></li>
                  <li><a href="../../pages/financeiro/relatorios-custos-setor.html"><span class="sub-item">Custos por
                        Setor</span></a></li>
                  <li><a href="../../pages/financeiro/relatorios-comparativos.html"><span
                        class="sub-item">Comparativos</span></a></li>
                </ul>
              </div>
            </li>

            <!-- Outros Relat√≥rios -->
            <li class="nav-item">
              <a data-bs-toggle="collapse" href="#finOutrosRelatorios" aria-expanded="false">
                <i class="fas fa-chart-line"></i>
                <p>Relat√≥rios</p><span class="caret"></span>
              </a>
              <div class="collapse" id="finOutrosRelatorios">
                <ul class="nav nav-collapse">
                  <li><a href="../../pages/financeiro/gerar-memorando.html"><span class="sub-item">Memorandos</span></a>
                  </li>
                  <li><a href="../../pages/financeiro/relatorios-rotas.html"><span class="sub-item">Por Rota</span></a>
                  </li>
                  <li><a href="../../pages/financeiro/relatorios-geral.html"><span class="sub-item">Geral</span></a>
                  </li>
                </ul>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <!-- END SIDEBAR -->


    <div class="main-panel">
      <div class="main-header" style="top: 0;">
        <div class="main-header-logo">
          <div class="logo-header" data-background-color="dark">
            <a href="../../pages/transporte-escolar/dashboard-escolar.html" class="logo">
              <img src="../../assets/img/pydenadmin/logo_light.png" alt="navbar brand" class="navbar-brand"
                height="20" />
            </a>
            <div class="nav-toggle">
              <button class="btn btn-toggle toggle-sidebar">
                <i class="gg-menu-right"></i>
              </button>
              <button class="btn btn-toggle sidenav-toggler">
                <i class="gg-menu-left"></i>
              </button>
            </div>
            <button class="topbar-toggler more">
              <i class="gg-more-vertical-alt"></i>
            </button>
          </div>
        </div>

        <nav class="navbar navbar-header navbar-header-transparent navbar-expand-lg border-bottom">
          <div class="container-fluid">
            <!-- √çcones de mensagens, notifica√ß√µes, a√ß√µes r√°pidas, etc. -->
            <ul class="navbar-nav topbar-nav ms-md-auto align-items-center">
            <button id="themeToggle" class="btn btn-sm btn-outline-secondary ms-2" onclick="toggleTheme()">
              üåô/‚òÄÔ∏è
            </button>
              <!-- =====================================
             √çCONE MENSAGENS (exemplo)
        ===================================== -->
              <li class="nav-item topbar-icon dropdown hidden-caret">
                <a class="nav-link dropdown-toggle" href="#" id="messageDropdown" role="button"
                  data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  <i class="fa fa-envelope"></i>
                </a>
                <ul class="dropdown-menu messages-notif-box animated fadeIn" aria-labelledby="messageDropdown">
                  <li>
                    <div class="dropdown-title d-flex justify-content-between align-items-center">
                      Mensagens
                      <a href="#" class="small">Marcar todas como lidas</a>
                    </div>
                  </li>
                  <li>
                    <div class="message-notif-scroll scrollbar-outer">
                      <div class="notif-center">
                        <a href="#">
                          <div class="notif-img">
                            <img src="../../assets/img/jm_denis.jpg" alt="Img Profile" />
                          </div>
                          <div class="notif-content">
                            <span class="subject">Jimmy Denis</span>
                            <span class="block">Como voc√™ est√°?</span>
                            <span class="time">H√° 5 minutos</span>
                          </div>
                        </a>
                      </div>
                    </div>
                  </li>
                  <li>
                    <a class="see-all" href="javascript:void(0);">
                      Ver todas as mensagens
                      <i class="fa fa-angle-right"></i>
                    </a>
                  </li>
                </ul>
              </li>

              <!-- =====================================
             √çCONE NOTIFICA√á√ïES (DIN√ÇMICO)
        ===================================== -->
              <li class="nav-item topbar-icon dropdown hidden-caret">
                <a class="nav-link dropdown-toggle" href="#" id="notifDropdown" role="button" data-bs-toggle="dropdown"
                  aria-haspopup="true" aria-expanded="false">
                  <i class="fa fa-bell"></i>
                  <span class="notification" id="notifCount">0</span>
                </a>
                <ul class="dropdown-menu notif-box animated fadeIn" aria-labelledby="notifDropdown">
                  <li>
                    <div class="dropdown-title" id="notifTitle">
                      Voc√™ n√£o tem novas notifica√ß√µes
                    </div>
                  </li>
                  <li>
                    <div class="notif-scroll scrollbar-outer">
                      <div class="notif-center" id="notifList">
                        <!-- Conte√∫do gerado dinamicamente -->
                      </div>
                    </div>
                  </li>
                  <li>
                    <a class="see-all" href="javascript:void(0);" id="notifSeeAll">
                      Ver todas as notifica√ß√µes
                      <i class="fa fa-angle-right"></i>
                    </a>
                  </li>
                </ul>
              </li>

              <!-- =====================================
             √çCONE A√á√ïES R√ÅPIDAS
        ===================================== -->
              <li class="nav-item topbar-icon dropdown hidden-caret">
                <a class="nav-link dropdown-toggle" href="#" id="quickActionsDropdown" role="button"
                  data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  <i class="fas fa-layer-group"></i>
                </a>
                <div class="dropdown-menu quick-actions animated fadeIn">
                  <div class="quick-actions-header">
                    <span class="title mb-1">A√ß√µes R√°pidas</span>
                    <span class="subtitle op-7">Atalhos</span>
                  </div>
                  <div class="quick-actions-scroll scrollbar-outer">
                    <div class="quick-actions-items">
                      <div class="row m-0">
                        <a class="col-6 col-md-4 p-0" href="/pages/transporte-escolar/escolas-cadastrar.html">
                          <div class="quick-actions-item">
                            <div class="avatar-item bg-primary rounded-circle">
                              <i class="fas fa-school"></i>
                            </div>
                            <span class="text">Cad. Escola</span>
                          </div>
                        </a>
                        <a class="col-6 col-md-4 p-0" href="/pages/transporte-escolar/monitores-cadastrar.html">
                          <div class="quick-actions-item">
                            <div class="avatar-item bg-success rounded-circle">
                              <i class="fas fa-user-check"></i>
                            </div>
                            <span class="text">Cad. Monitor</span>
                          </div>
                        </a>
                        <a class="col-6 col-md-4 p-0" href="/pages/transporte-escolar/rotas-listar.html">
                          <div class="quick-actions-item">
                            <div class="avatar-item bg-warning rounded-circle">
                              <i class="fas fa-route"></i>
                            </div>
                            <span class="text">Listar Rotas</span>
                          </div>
                        </a>
                        <a class="col-6 col-md-4 p-0" href="/pages/transporte-administrativo/frota-listar.html">
                          <div class="quick-actions-item">
                            <div class="avatar-item bg-info rounded-circle">
                              <i class="fas fa-warehouse"></i>
                            </div>
                            <span class="text">Listar Frota</span>
                          </div>
                        </a>
                        <!-- ... Adicione mais se quiser -->
                      </div>
                    </div>
                  </div>
                </div>
              </li>

              <!-- =====================================
             DROPDOWN USU√ÅRIO
        ===================================== -->
              <li class="nav-item topbar-user dropdown hidden-caret">
                <a class="dropdown-toggle profile-pic" data-bs-toggle="dropdown" href="#" aria-expanded="false">
                  <div class="avatar-sm">
                    <img src="../../assets/img/profile.jpg" alt="..." class="avatar-img rounded-circle" />
                  </div>
                  <span class="profile-username">
                    <span class="op-7">Ol√°,</span>
                    <span class="fw-bold" id="dropdownUserName">Carregando...</span>
                  </span>
                </a>
                <ul class="dropdown-menu dropdown-user animated fadeIn">
                  <div class="dropdown-user-scroll scrollbar-outer">
                    <li>
                      <div class="user-box">
                        <div class="avatar-lg">
                          <img src="../../assets/img/profile.jpg" alt="image profile" class="avatar-img rounded" />
                        </div>
                        <div class="u-text">
                          <h4 id="dropdownUserBoxName">Nome do Usu√°rio</h4>
                          <p class="text-muted" id="dropdownUserEmail">email@exemplo.com</p>
                          <a href="/pages/usuarios/meu-perfil.html" class="btn btn-xs btn-secondary btn-sm">Ver
                            Perfil</a>
                        </div>
                      </div>
                    </li>
                    <li>
                      <div class="dropdown-divider"></div>
                      <a class="dropdown-item" href="/pages/usuarios/meu-perfil.html">Meu Perfil</a>
                      <a class="dropdown-item" href="/pages/usuarios/caixa-entrada.html">Caixa de Entrada</a>
                      <div class="dropdown-divider"></div>
                      <a class="dropdown-item" href="/pages/usuarios/configuracoes.html">Configura√ß√µes</a>
                      <div class="dropdown-divider"></div>
                      <a class="dropdown-item" href="#" id="logoutLink">Sair</a>
                    </li>
                  </div>
                </ul>
              </li>
            </ul>
          </div>
        </nav>
      </div>


      <div class="container">
        <div class="page-inner">
          <!-- Cabe√ßalho do Dashboard -->
          <div class="d-flex align-items-left align-items-md-center flex-column flex-md-row pt-2 pb-4">
            <div>
              <h3 class="fw-bold mb-3">Painel de Controle</h3>
              <h6 class="op-7 mb-2">Sistema de Gest√£o de Transporte Escolar</h6>
            </div>
            <div class="ms-md-auto py-2 py-md-0">
              <!-- Bot√£o para abrir o modal com o formul√°rio completo -->
              <button type="button" class="btn btn-primary btn-round" data-bs-toggle="modal"
                data-bs-target="#modalAdicionarAluno">Adicionar Aluno</button>
            </div>
          </div>

          <!-- Cards de Estat√≠sticas (Linha de cima - agora com 4 colunas) -->
          <div class="row">
            <div class="col-sm-3 col-md-3">
              <div class="card card-stats card-round">
                <div class="card-body">
                  <div class="row align-items-center">
                    <div class="col-icon">
                      <div class="icon-big text-center icon-primary bubble-shadow-small">
                        <i class="fas fa-user-graduate"></i>
                      </div>
                    </div>
                    <div class="col col-stats ms-3 ms-sm-0">
                      <div class="numbers">
                        <p class="card-category">Alunos</p>
                        <h4 class="card-title" id="alunos-ativos">0</h4>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-sm-3 col-md-3">
              <div class="card card-stats card-round">
                <div class="card-body">
                  <div class="row align-items-center">
                    <div class="col-icon">
                      <div class="icon-big text-center icon-info bubble-shadow-small">
                        <i class="fas fa-route"></i>
                      </div>
                    </div>
                    <div class="col col-stats ms-3 ms-sm-0">
                      <div class="numbers">
                        <p class="card-category">Rotas Escolares</p>
                        <h4 class="card-title" id="rotas-ativas">0</h4>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-sm-3 col-md-3">
              <div class="card card-stats card-round">
                <div class="card-body">
                  <div class="row align-items-center">
                    <div class="col-icon">
                      <div class="icon-big text-center icon-warning bubble-shadow-small">
                        <i class="fas fa-map"></i>
                      </div>
                    </div>
                    <div class="col col-stats ms-3 ms-sm-0">
                      <div class="numbers">
                        <p class="card-category">Zoneamentos</p>
                        <h4 class="card-title" id="zoneamentos-total">0</h4>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- NOVO CARD DE ESCOLAS -->
            <div class="col-sm-3 col-md-3">
              <div class="card card-stats card-round">
                <div class="card-body">
                  <div class="row align-items-center">
                    <div class="col-icon">
                      <div class="icon-big text-center icon-success bubble-shadow-small">
                        <i class="fas fa-school"></i>
                      </div>
                    </div>
                    <div class="col col-stats ms-3 ms-sm-0">
                      <div class="numbers">
                        <p class="card-category">Escolas</p>
                        <h4 class="card-title" id="escolas-total">0</h4>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- FIM DA LINHA DE CIMA -->

          <!-- NOVA LINHA DE CARDS (4 colunas) -->
          <div class="row mt-3">
            <div class="col-sm-3 col-md-3">
              <div class="card card-stats card-round">
                <div class="card-body">
                  <div class="row align-items-center">
                    <div class="col-icon">
                      <div class="icon-big text-center icon-danger bubble-shadow-small">
                        <i class="fas fa-id-card"></i>
                      </div>
                    </div>
                    <div class="col col-stats ms-3 ms-sm-0">
                      <div class="numbers">
                        <p class="card-category">Motoristas</p>
                        <h4 class="card-title" id="motoristas-total">0</h4>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-sm-3 col-md-3">
              <div class="card card-stats card-round">
                <div class="card-body">
                  <div class="row align-items-center">
                    <div class="col-icon">
                      <div class="icon-big text-center icon-secondary bubble-shadow-small">
                        <i class="fas fa-user-check"></i>
                      </div>
                    </div>
                    <div class="col col-stats ms-3 ms-sm-0">
                      <div class="numbers">
                        <p class="card-category">Monitores</p>
                        <h4 class="card-title" id="monitores-total">0</h4>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-sm-3 col-md-3">
              <div class="card card-stats card-round">
                <div class="card-body">
                  <div class="row align-items-center">
                    <div class="col-icon">
                      <div class="icon-big text-center icon-info bubble-shadow-small">
                        <i class="fas fa-truck-loading"></i>
                      </div>
                    </div>
                    <div class="col col-stats ms-3 ms-sm-0">
                      <div class="numbers">
                        <p class="card-category">Fornecedores</p>
                        <h4 class="card-title" id="fornecedores-total">0</h4>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-sm-3 col-md-3">
              <div class="card card-stats card-round">
                <div class="card-body">
                  <div class="row align-items-center">
                    <div class="col-icon">
                      <div class="icon-big text-center icon-warning bubble-shadow-small">
                        <i class="fas fa-map-marker-alt"></i>
                      </div>
                    </div>
                    <div class="col col-stats ms-3 ms-sm-0">
                      <div class="numbers">
                        <p class="card-category">Pontos de Parada</p>
                        <h4 class="card-title" id="pontos-total">0</h4>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- FIM DA NOVA LINHA DE CARDS -->

          <!-- Estat√≠sticas de Transporte -->
          <div class="row">
            <div class="col-md-12">
              <div class="card card-round">
                <div class="card-header">
                  <div class="card-head-row">
                    <div class="card-title">Estat√≠sticas de Transporte</div>
                    <div class="card-tools">
                      <a href="#" class="btn btn-label-success btn-round btn-sm me-2">
                        <span class="btn-label"><i class="fa fa-pencil"></i></span>
                        Exportar
                      </a>
                      <a href="#" class="btn btn-label-info btn-round btn-sm">
                        <span class="btn-label"><i class="fa fa-print"></i></span>
                        Imprimir
                      </a>
                    </div>
                  </div>
                </div>
                <div class="card-body">
                  <div class="chart-container" style="min-height: 375px">
                    <canvas id="statisticsChart"></canvas>
                  </div>
                  <div id="myChartLegend"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>


      <footer class="footer">
        <div class="container-fluid d-flex justify-content-between">
          <nav class="pull-left">
            <ul class="nav">
              <li class="nav-item"><a class="nav-link" target="_blank" href="https://pydenexpress.com/">PyDen
                  Express</a>
              </li>
              <li class="nav-item"><a class="nav-link" href="#">Ajuda</a></li>
              <li class="nav-item"><a class="nav-link" href="#">Termos de Uso</a></li>
            </ul>
          </nav>
          <div class="copyright">
            2025 &copy; Todos os direitos reservados
          </div>
          <div>
            Desenvolvido por <a target="_blank" href="http://www.pyden.tech">PyDen Technologies</a>&reg;.
          </div>
        </div>
      </footer>
    </div>
  </div>

  <!-- Modal Solicitar Concess√£o de Rota (Form completo) -->
  <div class="modal fade" id="modalAdicionarAluno" tabindex="-1" role="dialog"
    aria-labelledby="modalAdicionarAlunoLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl" role="document">
      <div class="modal-content">
        <form id="solicitacao-form">
          <div class="modal-header">
            <h5 class="modal-title" id="modalAdicionarAlunoLabel">Solicitar Concess√£o de Rota</h5>
            <button type="button" class="close btn btn-link" data-bs-dismiss="modal" aria-label="Close">
              <i class="fa fa-times"></i>
            </button>
          </div>
          <div class="modal-body">
            <!-- Campos do formul√°rio -->
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="nomeResponsavel" class="form-label">Nome Completo do Respons√°vel</label>
                <input type="text" class="form-control" id="nomeResponsavel" name="nome_responsavel" required>
              </div>
              <div class="col-md-3 mb-3">
                <label for="cpfResponsavel" class="form-label">CPF do Respons√°vel</label>
                <input type="text" class="form-control" id="cpfResponsavel" name="cpf_responsavel" maxlength="14"
                  required>
              </div>
              <div class="col-md-3 mb-3">
                <label for="celularResponsavel" class="form-label">Celular (WhatsApp)</label>
                <input type="text" class="form-control" id="celularResponsavel" name="celular_responsavel"
                  maxlength="15" required>
              </div>
            </div>
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="idMatriculaAluno" class="form-label">ID de Matr√≠cula do Aluno</label>
                <input type="text" class="form-control" id="idMatriculaAluno" name="id_matricula_aluno" required>
              </div>
              <div class="col-md-6 mb-3">
                <label for="escolaSelect" class="form-label">Selecione a Escola</label>
                <select class="form-select" id="escolaSelect" name="escola_id" required>
                  <option value="">Selecione uma Escola</option>
                </select>
              </div>
            </div>
            <div class="row">
              <div class="col-md-4 mb-3">
                <label for="cep" class="form-label">CEP</label>
                <input type="text" class="form-control" id="cep" name="cep" required>
                <a href="https://portalcanaa.com.br/ceps/ceps-do-centro-canaa-dos-carajas/" target="_blank"
                  class="d-block mt-2">N√£o sei meu CEP</a>
              </div>
              <div class="col-md-4 mb-3">
                <label for="numero" class="form-label">N√∫mero</label>
                <input type="text" class="form-control" id="numero" name="numero" required>
                <button type="button" id="buscar-endereco" class="btn btn-secondary mt-2">Buscar Endere√ßo</button>
              </div>
              <div class="col-md-4 mb-3">
                <label for="endereco" class="form-label">Endere√ßo</label>
                <input type="text" class="form-control" id="endereco" name="endereco" readonly>
                <button type="button" id="buscar-coordenadas" class="btn btn-secondary mt-2" disabled>Buscar
                  Coordenadas</button>
              </div>
            </div>
            <div class="row">
              <div class="col-md-4 mb-3">
                <label class="form-label">O aluno pertence ao zoneamento da escola?</label><br>
                <input type="radio" id="zoneamentoSim" name="zoneamento" value="sim" required> Sim
                <input type="radio" id="zoneamentoNao" name="zoneamento" value="nao" required> N√£o
              </div>
              <div class="col-md-4 mb-3">
                <label class="form-label">O aluno √© p√∫blico do AEE?</label><br>
                <input type="radio" id="aeeSim" name="deficiencia" value="sim" onclick="mostrarUpload(true)" required>
                Sim
                <input type="radio" id="aeeNao" name="deficiencia" value="nao" onclick="mostrarUpload(false)" required>
                N√£o
              </div>
              <div class="col-md-4 mb-3" id="uploadLaudo" style="display: none;">
                <label for="laudoDeficiencia" class="form-label">Upload do Documento</label>
                <input type="file" class="form-control" id="laudoDeficiencia" name="laudo_deficiencia" accept="image/*">
              </div>
            </div>
            <div class="mb-3">
              <button type="button" id="verificar-direito" class="btn btn-secondary">Verificar Crit√©rios</button>
            </div>

            <!-- Mapa -->
            <div id="map" class="mt-3" style="height: 400px; width: 100%;"></div>
            <input id="longitude" name="longitude" type="hidden">
            <input id="latitude" name="latitude" type="hidden">

            <div class="mb-3 d-none" id="divComprovanteEndereco">
              <label for="comprovanteEndereco" class="form-label">Comprovante de Endere√ßo</label>
              <input type="file" class="form-control" id="comprovanteEndereco" name="comprovante_endereco"
                accept="image/*">
            </div>
            <div class="mb-3 d-none">
              <label for="observacoes" class="form-label">Observa√ß√µes</label>
              <textarea class="form-control" id="observacoes" name="observacoes" rows="4"
                placeholder="Descreva aqui qualquer situa√ß√£o ou necessidade espec√≠fica relacionada ao transporte escolar..."></textarea>
            </div>

          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
            <button type="submit" class="btn btn-primary d-none" id="enviar-solicitacao">Enviar Solicita√ß√£o</button>
          </div>
        </form>
      </div>
    </div>
  </div>


  <!-- Modal de Crit√©rios -->
  <div class="modal fade" id="modalDireito" tabindex="-1" aria-labelledby="modalDireitoLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalDireitoLabel">Crit√©rio de Direito ao Transporte</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div id="mensagemModal"></div>
          <div class="mb-3">
            <label for="observacoesModal" class="form-label">Observa√ß√µes</label>
            <textarea class="form-control" id="observacoesModal" name="observacoes_modal" rows="4"
              placeholder="Descreva aqui qualquer observa√ß√£o ou detalhe adicional..."></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
          <button type="button" class="btn btn-primary" id="confirmarSolicitacao">Enviar Solicita√ß√£o</button>
          <button type="button" class="btn btn-danger" id="encerrarSolicitacao">Encerrar Solicita√ß√£o</button>
        </div>
      </div>
    </div>
  </div>

  <!--   Core JS Files   -->
  <script src="../../assets/js/core/jquery-3.7.1.min.js"></script>
  <script src="../../assets/js/core/popper.min.js"></script>
  <script src="../../assets/js/core/bootstrap.min.js"></script>
  <script src="../../assets/js/usuario.js"></script>

  <!-- jQuery Scrollbar -->
  <script src="../../assets/js/plugin/jquery-scrollbar/jquery.scrollbar.min.js"></script>

  <!-- Chart JS -->
  <script src="../../assets/js/plugin/chart.js/chart.min.js"></script>

  <!-- jQuery Sparkline -->
  <script src="../../assets/js/plugin/jquery.sparkline/jquery.sparkline.min.js"></script>

  <!-- Chart Circle -->
  <script src="../../assets/js/plugin/chart-circle/circles.min.js"></script>

  <!-- Datatables -->
  <script src="../../assets/js/plugin/datatables/datatables.min.js"></script>

  <!-- Bootstrap Notify -->
  <script src="../../assets/js/plugin/bootstrap-notify/bootstrap-notify.min.js"></script>

  <!-- jQuery Vector Maps -->
  <script src="../../assets/js/plugin/jsvectormap/jsvectormap.min.js"></script>
  <script src="../../assets/js/plugin/jsvectormap/world.js"></script>

  <!-- Sweet Alert -->
  <script src="../../assets/js/plugin/sweetalert/sweetalert.min.js"></script>

  <!-- pydenadmin JS -->
  <script src="../../assets/js/pydenadmin.min.js"></script>

  <!-- pydenadmin DEMO methods, don't include it in your project! -->
  <script src="../../assets/js/setting-demo.js"></script>

  <script>
    let map, marker, escolaMarker, directionsService, directionsRenderer;

    function initMap() {
      map = new google.maps.Map(document.getElementById('map'), {
        center: { lat: -6.530066, lng: -49.851630 },
        zoom: 15,
        mapTypeId: 'satellite'
      });

      directionsService = new google.maps.DirectionsService();
      directionsRenderer = new google.maps.DirectionsRenderer({
        map: map,
        suppressMarkers: true,
        polylineOptions: {
          strokeColor: '#FF0000',
          strokeOpacity: 1,
          strokeWeight: 4,
          strokePattern: [
            { offset: '0', repeat: '10px' }
          ]
        }
      });

      map.addListener('click', function (event) {
        placeMarker(event.latLng);
        document.getElementById('latitude').value = event.latLng.lat();
        document.getElementById('longitude').value = event.latLng.lng();
      });
    }

    function placeMarker(location) {
      if (marker) {
        marker.setPosition(location);
      } else {
        marker = new google.maps.Marker({
          position: location,
          map: map
        });
      }
    }

    document.getElementById('buscar-endereco').addEventListener('click', async function () {
      const cep = document.getElementById('cep').value;
      const numero = document.getElementById('numero').value;
      const response = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
      const data = await response.json();

      if (data.logradouro) {
        const enderecoCompleto = `${data.logradouro}, ${numero}, ${data.bairro}, ${data.localidade} - ${data.uf}`;
        document.getElementById('endereco').value = enderecoCompleto;
        document.getElementById('buscar-coordenadas').disabled = false;
      } else {
        alert('Endere√ßo n√£o encontrado para o CEP informado.');
        document.getElementById('buscar-coordenadas').disabled = true;
      }
    });

    document.addEventListener('DOMContentLoaded', function () {
      document.getElementById('buscar-coordenadas').disabled = true;
      initMap();

      $.getJSON("/api/escolas", function (data) {
        var select = $("#escolaSelect");
        $.each(data, function (key, entry) {
          select.append($('<option></option>').attr('value', entry.id).text(entry.nome));
        });
      });
    });

    document.getElementById('buscar-coordenadas').addEventListener('click', function () {
      const endereco = document.getElementById('endereco').value;
      const geocoder = new google.maps.Geocoder();

      geocoder.geocode({ 'address': endereco }, function (results, status) {
        if (status === 'OK') {
          const location = results[0].geometry.location;
          map.setCenter(location);
          map.setZoom(25);
          placeMarker(location);
          document.getElementById('latitude').value = location.lat();
          document.getElementById('longitude').value = location.lng();
        } else {
          alert('Geocode falhou devido a: ' + status);
        }
      });
    });

    document.getElementById('verificar-direito').addEventListener('click', async function () {
      const latitude = document.getElementById('latitude').value;
      const longitude = document.getElementById('longitude').value;
      const escolaId = document.getElementById('escolaSelect').value;

      const zoneamento = document.querySelector('input[name="zoneamento"]:checked');
      if (!zoneamento) {
        alert('Por favor, selecione se o aluno pertence ao zoneamento da escola.');
        return;
      }

      const aee = document.querySelector('input[name="deficiencia"]:checked');
      if (!aee) {
        alert('Por favor, selecione se o aluno √© p√∫blico do AEE.');
        return;
      }

      if (aee.value === 'sim' && !document.getElementById('laudoDeficiencia').files.length) {
        alert('Por favor, envie o laudo de defici√™ncia antes de verificar os crit√©rios.');
        return;
      }

      if (!latitude || !longitude || !escolaId) {
        alert('Por favor, preencha todas as informa√ß√µes necess√°rias.');
        return;
      }

      try {
        const response = await fetch(`/api/escola-coordenadas?escola_id=${escolaId}`);
        const data = await response.json();

        if (data && data.latitude && data.longitude) {
          const escolaLatLng = { lat: parseFloat(data.latitude), lng: parseFloat(data.longitude) };

          if (escolaMarker) {
            escolaMarker.setPosition(escolaLatLng);
          } else {
            escolaMarker = new google.maps.Marker({
              position: escolaLatLng,
              map: map,
              icon: '/img/icones/escola-marcador.png'
            });
          }

          calculateAndDisplayRoute(latitude, longitude, escolaLatLng, zoneamento.value, aee.value);
        } else {
          alert('N√£o foi poss√≠vel encontrar as coordenadas da escola.');
        }
      } catch (error) {
        console.error('Erro ao buscar coordenadas da escola:', error);
        alert('Erro ao buscar coordenadas da escola. Tente novamente mais tarde.');
      }
    });

    function calculateAndDisplayRoute(alunoLat, alunoLng, escolaLatLng, zoneamento, aee) {
      const alunoLatLng = new google.maps.LatLng(alunoLat, alunoLng);
      const request = {
        origin: alunoLatLng,
        destination: escolaLatLng,
        travelMode: google.maps.TravelMode.WALKING
      };

      directionsService.route(request, function (result, status) {
        if (status === google.maps.DirectionsStatus.OK) {
          directionsRenderer.setDirections(result);

          const distance = result.routes[0].legs[0].distance.value / 1000; // Dist√¢ncia em km
          let mensagem = '';

          if (distance > 2 && zoneamento === 'sim') {
            mensagem = 'O aluno tem direito ao transporte.';
          } else if (distance > 2 && zoneamento === 'nao' && aee === 'sim') {
            mensagem = 'O aluno reside em um zoneamento n√£o atendido pela escola e √© p√∫blico AEE. Deseja prosseguir com a solicita√ß√£o?';
            mostrarUpload(true);
          } else if (distance > 2 && zoneamento === 'nao') {
            mensagem = 'O aluno reside em um zoneamento n√£o atendido pela escola. Deseja prosseguir com a solicita√ß√£o?';
            mostrarUpload(false);
          } else if (distance <= 2 && zoneamento === 'sim' && aee === 'sim') {
            mensagem = 'O aluno √© p√∫blico AEE, mas n√£o mora a mais de 2 km da escola. Por favor, descreva a defici√™ncia ou s√≠ndrome do aluno.';
            mostrarUpload(true);
          } else if (distance <= 2 && zoneamento === 'nao' && aee === 'sim') {
            mensagem = 'O aluno √© p√∫blico AEE, reside em um zoneamento n√£o atendido pela escola e mora a menos de 2 km. Por favor, descreva a defici√™ncia ou s√≠ndrome do aluno.';
            mostrarUpload(true);
          } else {
            mensagem = 'O aluno n√£o atende aos crit√©rios para o transporte escolar. Caso ainda deseje solicitar o transporte, forne√ßa mais detalhes sobre a sua solicita√ß√£o!';
          }

          document.getElementById('mensagemModal').textContent = mensagem;
          $('#modalDireito').modal('show');
        } else {
          alert('N√£o foi poss√≠vel calcular a rota: ' + status);
        }
      });
    }

    document.getElementById('confirmarSolicitacao').addEventListener('click', async function () {
      const observacoesModal = document.getElementById('observacoesModal').value;
      const criterioDireito = document.getElementById('mensagemModal').textContent;

      const observacoesInput = document.getElementById('observacoes');
      observacoesInput.classList.remove('d-none');
      observacoesInput.value += "\n" + observacoesModal;

      const inputCriterio = document.createElement('input');
      inputCriterio.type = 'hidden';
      inputCriterio.name = 'criterio_direito';
      inputCriterio.value = criterioDireito;
      document.getElementById('solicitacao-form').appendChild(inputCriterio);

      $('#modalDireito').modal('hide');

      document.getElementById('enviar-solicitacao').classList.remove('d-none');
    });

    document.getElementById('encerrarSolicitacao').addEventListener('click', function () {
      alert('Solicita√ß√£o encerrada.');
      $('#modalDireito').modal('hide');
    });

    document.getElementById('solicitacao-form').addEventListener('submit', async function (event) {
      event.preventDefault();
      const formData = new FormData(this);

      if (!document.getElementById('comprovanteEndereco').files.length) {
        formData.delete('comprovante_endereco');
      }

      try {
        const response = await fetch('/api/enviar-solicitacao', {
          method: 'POST',
          body: formData
        });
        const data = await response.json();

        if (response.ok) {
          alert('Solicita√ß√£o enviada com sucesso!');
          document.getElementById('solicitacao-form').reset();
          $('#modalAdicionarAluno').modal('hide');
        } else {
          alert(`Erro ao enviar a solicita√ß√£o: ${data.message}`);
        }
      } catch (error) {
        console.error('Erro ao enviar a solicita√ß√£o:', error);
        alert('Erro ao enviar a solicita√ß√£o. Tente novamente mais tarde.');
      }
    });

    $('#cpfResponsavel').on('input', function () {
      let cpf = $(this).val().replace(/\D/g, '');
      if (cpf.length > 11) {
        cpf = cpf.substring(0, 11);
      }
      cpf = cpf.replace(/(\d{3})(\d)/, "$1.$2");
      cpf = cpf.replace(/(\d{3})(\d)/, "$1.$2");
      cpf = cpf.replace(/(\d{3})(\d{1,2})$/, "$1-$2");
      $(this).val(cpf);
    });

    $('#celularResponsavel').on('input', function () {
      let celular = $(this).val().replace(/\D/g, '');
      if (celular.length > 11) {
        celular = celular.substring(0, 11);
      }
      celular = celular.replace(/(\d{2})(\d)/, "($1) $2");
      celular = celular.replace(/(\d{5})(\d{1,4})$/, "$1-$2");
      $(this).val(celular);
    });

    function mostrarUpload(mostrar) {
      const uploadDiv = document.getElementById('uploadLaudo');
      if (mostrar) {
        uploadDiv.style.display = 'block';
        document.getElementById('laudoDeficiencia').setAttribute('required', 'required');
      } else {
        uploadDiv.style.display = 'none';
        document.getElementById('laudoDeficiencia').removeAttribute('required');
      }
    }

    async function carregarDadosDashboard() {
      const res = await fetch('/api/dashboard');
      const data = await res.json();

      document.getElementById('alunos-ativos').textContent = data.alunos_ativos || 0;
      document.getElementById('rotas-ativas').textContent = data.rotas_ativas || 0;
      document.getElementById('zoneamentos-total').textContent = data.zoneamentos_total || 0;
      document.getElementById('motoristas-total').textContent = data.motoristas_total || 0;
      document.getElementById('monitores-total').textContent = data.monitores_total || 0;
      document.getElementById('fornecedores-total').textContent = data.fornecedores_total || 0;
      document.getElementById('pontos-total').textContent = data.pontos_total || 0;

      // Novo campo de escolas
      document.getElementById('escolas-total').textContent = data.escolas_total || 0;
    };

    document.addEventListener('DOMContentLoaded', carregarDadosDashboard);

    async function carregarEstatisticasTransporte() {
      const response = await fetch('/api/estatisticas-transporte');
      const dados = await response.json();

      const ctx = document.getElementById('statisticsChart').getContext('2d');
      const chartData = {
        labels: dados.periodo || [],
        datasets: [
          {
            label: 'Total de Rotas',
            data: dados.totalRotas || [],
            borderColor: '#87CEEB',
            backgroundColor: 'rgba(135,206,235,0.2)',
            fill: false,
            tension: 0.4
          },
          {
            label: 'Rotas Urbanas',
            data: dados.rotasUrbana || [],
            borderColor: 'orange',
            backgroundColor: 'rgba(255,165,0,0.2)',
            fill: false,
            tension: 0.4
          },
          {
            label: 'Rotas Rurais',
            data: dados.rotasRural || [],
            borderColor: 'green',
            backgroundColor: 'rgba(0,128,0,0.2)',
            fill: false,
            tension: 0.4
          }
        ]
      };

      const chartOptions = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: false
        },
        scales: {
          y: {
            beginAtZero: true
          }
        }
      };

      const estatisticasChart = new Chart(ctx, {
        type: 'line',
        data: chartData,
        options: chartOptions
      });

      if (document.getElementById('myChartLegend')) {
        document.getElementById('myChartLegend').innerHTML = estatisticasChart.generateLegend();
      }
    }

    document.addEventListener('DOMContentLoaded', async () => {
      await carregarEstatisticasTransporte();
    });
  </script>
</body>

</html>